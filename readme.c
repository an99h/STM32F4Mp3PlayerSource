
，							STM32F07VGT6硬件连接图
//////////////////////////////////////////////////////////////////////////////////
//																				//
//					ILI9341	8位数据线		2.4寸LCD屏幕引脚配置				//
//					数据线：PE0 --------->LCD_D0								//
//						 	PE1 --------->LCD_D1								//
//							PE2 --------->LCD_D2								//
//							PE3 --------->LCD_D3								//
//							PE4 --------->LCD_D4								//
//							PE5 --------->LCD_D5								//
//							PE6 --------->LCD_D6								//
//							PE7 --------->LCD_D7								//
//					控制线：PB0 --------->LCD_CS								//
//							PB1 --------->LCD_RS								//
//							PB12--------->LCD_WR								//
//							PB13--------->LCD_WD								//
//							PB14--------->LCD_REST								//
//																				//
//																				//
//					TF卡SPI1引脚配置											//
//							PA5--------->SD_CLK									//
//						 	PA6--------->SD_MISO								//
//							PA7--------->SD_MOSI								//
//							PC5--------->SD_CS									//
//																				//
//																				//
//																				//
//					USB-OTG引脚配置												//
//							PA9 --------->OTG_FS_VBUS							//
//							PA10--------->OTG_FS_ID								//
//							PA11--------->OTG_FS_DM								//
//																				//
//																				//
//					音频解码芯片CS43L22											//
//					I2C配置	PD4 --------->REST									//
//							PB6 --------->SCL									//
//							PB9 --------->SDA									//
//					I2S配置	PA4 --------->WS									//
//							PC10--------->SCK									//
//							PC12--------->SD									//
//							PC7 --------->MCK									//
//																				//
//																				//
//					USART3串口引脚配置											//
//							PB10--------->USART3_TX								//
//							PB11--------->USART3_RX								//
//																				//
//																				//
//					按键引脚配置												//
//							PA0--------->KEY0_PRESS								//
//							PD0--------->PAGE_DOWN								//
//							PD1--------->NEXT_SONG								//
//							PD2--------->VOL_UP									//
//							PD3--------->PAUSE_SONG								//
//							PB3--------->VOL_DOWN								//
//							PD5--------->STOP_SONG								//
//							PD6--------->PAGE_UP								//
//							PD7--------->LAST_SONG								//
//																				//
//																				//
//////////////////////////////////////////////////////////////////////////////////

/************************************************************

@version:201160407

1.修改部分全局变量
2.新增loding界面，按任意键进入音乐播放界面

************************************************************/

/************************************************************

@version:201160325

1.新增汉字取模显示

************************************************************/


/************************************************************

@version:201160103

1.新增生产测试模式
	KEY TEST
	LED TEST
	LCD TEST
	USART TEST

************************************************************/



/************************************************************

@version:20151231

1.新增按停止键后提示版本信息
┌─────────────────────────────────────────────┐
│	@     MCU      : STM32F407VGT6            │
│	@   Version    : 2015.12.31               │
│	@ Copyright(C) : 2015-2016                │
│	@ Designed by ANG in Shanghai             │
│	@ Anhui Science and Technology University │
└─────────────────────────────────────────────┘

************************************************************/


/************************************************************

@version:20151229

1.优化显示当前播放时间函数
2.修复右边文件列表有时不能正确匹配当前播放歌曲的问题

************************************************************/

/************************************************************

@version:20151228

1.新增显示当前播放时间,未获取到MP3文件总时间,格式为(00:02/00:00)

************************************************************/


/************************************************************

@version:20151225

1.优化Mp3PlayerStart()和files_list()两个函数里的按键控制

************************************************************/

/************************************************************

@version:20151222

1.新增按停止键后删除所有任务
2.新增SD卡和U盘都未插入时显示插入提示语
3.修复正在播放音乐时U盘拔出后声音变成噪音问题
4.新增上一曲，暂停，下一曲图标显示
5.改变UI显示方式
┌─────────────────────────────────────┐
├─────────────────────┬──────────────┬┤
│  CPU   VOL   MODE   │              ││
│─────────────────────┤              ││
│                     │  FILES LIST  ││
│   PLAY MUSIC        │              ││
│ time        count   │              ││
│   ◀◀  ▶  ▶▶        │              ││
│─────────────────────┤              ││
│   SD/USB TOTAL      │              ││
│   SD/USB FREE       │              ││
├─────────────────────┴──────────────┴┤
└─────────────────────────────────────┘

************************************************************/

/************************************************************

@version:20151222

1.新增右边文件列表滚动条显示
2.修复文件列表总数整10时多显示一页问题

************************************************************/

/************************************************************

@version:20151218

1.优化界面显示，新增图片背景，此版本仅供测试图片取模，不作为后期版本基础
代码在20151218备份里面

************************************************************/


/************************************************************

@version:20151217

1.新增user键切换音乐播放模式	1:单曲循环	O:全部循环	X:随机播放
2.修复在按上一曲时，从第一首到最后一首歌曲需要连续按两次的问题

************************************************************/


/************************************************************

@version:20151216

1.删除FATFS文件系统里的cc936.c文件--->中文Unicode编码
 这样目标HEX文件从700K减小到200+K
2.修复多次按上一曲/下一曲死机的问题
3.修改右边文件列表不自动刷新，刷屏会导致放音乐时有杂音

************************************************************/


/************************************************************

@version:20151215

1.新增按键上一曲，下一曲，上一页，下一页，音量加，音量减,暂停，停止
右边音乐列表在切换上一曲/下一曲时有时候不刷新
2.修改当前播放歌曲高亮(■■■■)为箭头（>>）提示
3.修复文件列表不能自动刷新问题

需要注意的是，user键是高电平有效，其他键是低电平有效

┌───────────────────────────────┐
│ 上一页  音量减  音量加 下一页	│
│	↓		↓		↓		↓	│
│	●		●		●		●	│
│								│		按键映射图
│	●		●		●		●	│
│	↑		↑		↑		↑	│
│ 上一曲   停止  暂停    下一曲	│
└───────────────────────────────┘

************************************************************/



/************************************************************

@version:20151214

1.修复无法获取U盘容量问题
2.增加简单UI显示（单页）
┌────────────────────────────────────┐
├─────────────────────┬──────────────┤
│  PLAY MUSIC         │              │
│              count  │              │
│─────────────────────┤              │
│   TOTAL             │  FILES LIST  │
│   FREE              │              │
│─────────────────────┤              │
│ CPU  VOLUME         │              │
├─────────────────────┴──────────────┤
└────────────────────────────────────┘

************************************************************/


/************************************************************

@version:20151213

1.修复USB播放音乐不能获取文件列表问题

目前存在问题：
1.之前未修复的问题-------->部分解决
2.播放音乐时文件列表翻页会有“啵啵”杂音
3.高亮当前播放歌曲需手动刷新-------->已解决
4.无法获取U盘容量-------->已解决

************************************************************/


/************************************************************

@version:20151212

1.新增高亮当前播放歌曲名
2.新增获取SD卡容量

************************************************************/


/************************************************************

@version:20151211

1.新增获取SD卡/MUSIC目录下文件列表，每页显示10个文件，按user键切换下一页

************************************************************/

/************************************************************

@version:20151210

1.修复编译时出现几十处同样的警告
2.修改USART3部分注释

************************************************************/


/************************************************************

@version:20151208

1.优化SD卡和USB任务之间的调度，SD卡任务优先级大于USB任务优先级，
  SD卡初始化失败或挂载失败时删除自身任务，SD卡任务初始化成功后删除USB任务。
2.修复SD卡播放音乐时切换上一曲死机问题
3.修复SD卡和USB不能同时插入问题
4.修改部分函数和变量名称，WAV替换成Mp3

************************************************************/


/************************************************************

@version:20151207

1.新增SD卡播放音乐
2.删除部分多余代码

目前存在问题：
0.切换上一曲，第一首歌到最后一首歌时要连续按两次-------->未找到原因				-------->再现率100%-------->已解决
1.有时候一首歌没放完就挂了╮(╯▽╰)╭				-------->内存满了问题			-------->再现率小于50%-------->已解决
2.开始播放歌曲时有一秒左右的呲呲声音			-------->未找到原因				-------->再现率100%
3.切歌时有爆音									-------->切歌时LCD显示刷屏导致	-------->再现率100%
4.不支持播放中文歌曲名的音乐					-------->没有对长文件名的支持	-------->再现率100%
5.CPU占用率比较高 达到90%左右					-------->这个是硬伤				-------->再现率100%
6.CPU占用率有时候不显示							-------->未找到原因				-------->再现率小于100%
7.SD卡和USB两者不能同时插入，否则卡死			-------->两个任务同时播放，导致内存不够-------->再现率100%-------->已解决


************************************************************/


/************************************************************

@version:20151204

1.注释了LED灯显示代码 -.-|因为刺眼
2.新增user键切换上一曲/下一曲
3.修改部分变量定义类型，减少内存占用


************************************************************/


/************************************************************

@version:20151203

1.新增按user键切换下一首歌
2.修改LED灯闪烁方式，通过srand()播种，rand()产生随机值

目前存在问题：
1.开始播放歌曲时有一秒左右的呲呲声音
2.切歌时有爆音
3.不支持播放中文歌曲名的音乐
4.CPU占用率比较高 达到90%左右

************************************************************/



/************************************************************

@version:20151202

1.新增USB播放指定目录下的歌曲，如果该文件夹内有非MP3文件，自动跳过

测试项目：
USB任务播放0:/MUSIC目录下歌曲	LCD显示路径+歌曲名
LED任务循环闪烁

************************************************************/



/************************************************************

@version:20151201 

新增USB播放指定歌曲

测试项目：
USB任务播放指定歌曲
LED任务循环闪烁

后期添加：
0.切歌：上一曲，下一曲，暂停，停止
1.图片解码
2.SD卡播放音乐
3.GUI显示
4.外部FLASH挂载和中文字库加载

************************************************************/


/************************************************************

@version:20151128
本版本基本功能：
1.KEY正常
2.LED正常
3.LCD正常
4.SD卡和FATFS文件系统正常
5.UCOSII消息邮箱正常

测试项目：
操作系统UCOSII，创建5个任务
任务1：LED3每隔300毫秒闪烁一次
任务2：LED4每隔1秒循环闪烁一次
任务3：KEY按一次通过消息邮箱发送KEY值给任务4和任务5
任务4：通过获取消息邮箱KEY值控制LED2亮灭
任务5：LCD显示SD卡状态 CPU状态 按键状态

************************************************************/



/************************************************************

本课题是我的毕业设计
项目启动时间在2015年11月初
最终结束时间定为2016年3月底

************************************************************/

